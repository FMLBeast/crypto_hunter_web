{% extends "base.html" %}

{% block title %}Dashboard - Arweave Puzzle #11{% endblock %}

{% block content %}
<div class="space-y-6">
    <!-- Header -->
    <div class="bg-white rounded-lg shadow p-6">
        <div class="flex items-center justify-between">
            <div>
                <h1 class="text-3xl font-bold text-gray-900">ðŸŽ¯ Arweave Puzzle #11 Tracker</h1>
                <p class="mt-2 text-gray-600">Visual Steganography Analysis Dashboard</p>
            </div>
            <div class="flex space-x-4">
                <a href="{{ url_for('files.add_file') }}" class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-md font-medium">
                    <i class="fas fa-plus mr-2"></i>Add File
                </a>
                <a href="{{ url_for('files.bulk_import') }}" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md font-medium">
                    <i class="fas fa-upload mr-2"></i>Bulk Import
                </a>
            </div>
        </div>
    </div>

    <!-- Statistics Cards -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
        <div class="bg-white rounded-lg shadow p-6">
            <div class="flex items-center">
                <div class="p-3 bg-blue-100 rounded-full">
                    <i class="fas fa-files-o text-blue-600 text-xl"></i>
                </div>
                <div class="ml-4">
                    <p class="text-3xl font-semibold text-gray-900">{{ total_files }}</p>
                </div>
            </div>
        </div>

        <div class="bg-white rounded-lg shadow p-6">
            <div class="flex items-center">
                <div class="p-3 bg-green-100 rounded-full">
                    <i class="fas fa-check-circle text-green-600 text-xl"></i>
                </div>
                <div class="ml-4">
                    <p class="text-sm font-medium text-gray-500">Analyzed</p>
<p class="text-3xl font-semibold text-gray-900">{{ analyzed_files }}</p>
                </div>
            </div>
        </div>

        <div class="bg-white rounded-lg shadow p-6">
            <div class="flex items-center">
                <div class="p-3 bg-yellow-100 rounded-full">
                    <i class="fas fa-clock text-yellow-600 text-xl"></i>
                </div>
                <div class="ml-4">
                    <p class="text-sm font-medium text-gray-500">Pending</p>
<p class="text-3xl font-semibold text-gray-900">{{ pending_files }}</p>
                </div>
            </div>
        </div>

        <div class="bg-white rounded-lg shadow p-6">
            <div class="flex items-center">
                <div class="p-3 bg-purple-100 rounded-full">
                    <i class="fas fa-gem text-purple-600 text-xl"></i>
                </div>
                <div class="ml-4">
                   <p class="text-3xl font-semibold text-gray-900">{{ total_files }}</p>
<p class="text-3xl font-semibold text-gray-900">{{ total_files }}</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Progress Bar -->
    <div class="bg-white rounded-lg shadow p-6">
        <h2 class="text-lg font-semibold text-gray-900 mb-4">Analysis Progress</h2>
        <div class="w-full bg-gray-200 rounded-full h-4">
            <div class="bg-indigo-600 h-4 rounded-full transition-all duration-300" style="width: {{ progress_percentage }}%"></div>
        </div>
        <p class="mt-2 text-sm text-gray-600">{{ "%.1f"|format(progress_percentage) }}% Complete</p>
    </div>

    <!-- Quick Actions -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <!-- SHA Search -->
        <div class="bg-white rounded-lg shadow p-6">
            <h2 class="text-lg font-semibold text-gray-900 mb-4">
                <i class="fas fa-search mr-2"></i>Quick SHA Search
            </h2>
            <div class="space-y-4">
                <div>
                    <input type="text" id="sha-search" placeholder="Enter SHA256 hash..." 
                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                </div>
                <div id="search-results" class="hidden">
                    <!-- Search results will be populated here -->
                </div>
                <div class="flex space-x-2">
                    <a href="{{ url_for('files.file_list') }}" class="text-indigo-600 hover:text-indigo-800 text-sm">
                        Browse All Files â†’
                    </a>
                    <span class="text-gray-300">|</span>
                    <a href="{{ url_for('graph.visual_graph') }}" class="text-indigo-600 hover:text-indigo-800 text-sm">
                        View Relationship Graph â†’
                    </a>
                </div>
            </div>
        </div>

        <!-- Recent Activity -->
        <div class="bg-white rounded-lg shadow p-6">
            <h2 class="text-lg font-semibold text-gray-900 mb-4">
                <i class="fas fa-clock mr-2"></i>Analysis Vectors
            </h2>
            <div class="space-y-3">
                {% for vector in vectors %}
                <div class="flex items-center justify-between p-3 bg-gray-50 rounded-md">
                    <div class="flex items-center">
                        <span class="text-lg mr-3">{{ vector.icon }}</span>
                        <div>
                            <p class="font-medium text-gray-900">{{ vector.name }}</p>
                            <p class="text-sm text-gray-600">{{ vector.description }}</p>
                        </div>
                    </div>
                    <div class="text-right">
                        <p class="text-sm font-medium text-gray-900">{{ vector.findings_count }} findings</p>
                        <div class="w-16 bg-gray-200 rounded-full h-2 mt-1">
                            <div class="h-2 rounded-full transition-all duration-300" 
                                 style="width: {{ vector.progress_percentage }}%; background-color: {{ vector.color }}"></div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>

    <!-- Top Contributors -->
    <div class="bg-white rounded-lg shadow p-6">
        <h2 class="text-lg font-semibold text-gray-900 mb-4">
            <i class="fas fa-trophy mr-2"></i>Top Contributors
        </h2>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
            {% for user in top_users %}
            <div class="flex items-center p-4 bg-gray-50 rounded-lg">
                <div class="flex-shrink-0">
                    <div class="w-10 h-10 bg-indigo-100 rounded-full flex items-center justify-center">
                        <span class="text-indigo-600 font-semibold">{{ user.username[0].upper() }}</span>
                    </div>
                </div>
                <div class="ml-4">
                    <p class="text-sm font-medium text-gray-900">{{ user.display_name or user.username }}</p>
                    <p class="text-sm text-gray-500">{{ user.points }} points â€¢ {{ user.level }}</p>
                    <p class="text-xs text-gray-400">{{ user.contributions_count }} contributions</p>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- Quick Links -->
    <div class="bg-white rounded-lg shadow p-6">
        <h2 class="text-lg font-semibold text-gray-900 mb-4">
            <i class="fas fa-link mr-2"></i>Quick Links
        </h2>
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
            <a href="{{ url_for('analysis.findings_list') }}" class="block p-4 text-center bg-blue-50 hover:bg-blue-100 rounded-lg transition-colors">
                <i class="fas fa-search text-blue-600 text-2xl mb-2"></i>
                <p class="text-sm font-medium text-blue-900">View Findings</p>
            </a>
            <a href="{{ url_for('graph.visual_graph') }}" class="block p-4 text-center bg-green-50 hover:bg-green-100 rounded-lg transition-colors">
                <i class="fas fa-project-diagram text-green-600 text-2xl mb-2"></i>
                <p class="text-sm font-medium text-green-900">Relationship Graph</p>
            </a>
<a href="{{ url_for('analysis.analysis_stats') }}" class="block p-4 text-center bg-purple-50 hover:bg-purple-100 rounded-lg transition-colors">                <i class="fas fa-chart-bar text-purple-600 text-2xl mb-2"></i>
                <p class="text-sm font-medium text-purple-900">Statistics</p>
            </a>
            <a href="{{ url_for('files.bulk_import') }}" class="block p-4 text-center bg-yellow-50 hover:bg-yellow-100 rounded-lg transition-colors">
                <i class="fas fa-upload text-yellow-600 text-2xl mb-2"></i>
                <p class="text-sm font-medium text-yellow-900">Bulk Import</p>
            </a>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Enhanced SHA search with live results
    const searchInput = document.getElementById('sha-search');
    const searchResults = document.getElementById('search-results');
    let searchTimeout;

    searchInput.addEventListener('input', function() {
        clearTimeout(searchTimeout);
        const query = this.value.trim();
        
        if (query.length >= 4) {
            searchTimeout = setTimeout(async () => {
                try {
                    const response = await fetch(`/api/search-sha?q=${encodeURIComponent(query)}`);
                    const results = await response.json();
                    displaySearchResults(results);
                } catch (error) {
                    console.error('Search error:', error);
                    searchResults.innerHTML = '<p class="text-red-600 text-sm">Search error occurred</p>';
                    searchResults.classList.remove('hidden');
                }
            }, 300);
        } else {
            searchResults.classList.add('hidden');
        }
    });

    function displaySearchResults(results) {
        if (results.length === 0) {
            searchResults.innerHTML = '<p class="text-gray-500 text-sm">No files found</p>';
        } else {
            const resultsHtml = results.map(file => `
                <div class="border-b border-gray-200 py-2 last:border-b-0">
                    <a href="/files/${file.sha}" class="block hover:bg-gray-50 p-2 rounded">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="font-medium text-gray-900">${file.filename}</p>
                                <p class="text-sm text-gray-500">${file.sha.substring(0, 16)}...</p>
                            </div>
                            <div class="text-right">
                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${
                                    file.status === 'complete' ? 'bg-green-100 text-green-800' : 
                                    file.status === 'pending' ? 'bg-yellow-100 text-yellow-800' : 
                                    'bg-gray-100 text-gray-800'
                                }">
                                    ${file.status}
                                </span>
                            </div>
                        </div>
                    </a>
                </div>
            `).join('');
            
            searchResults.innerHTML = `<div class="border border-gray-200 rounded-md bg-white max-h-64 overflow-y-auto">${resultsHtml}</div>`;
        }
        searchResults.classList.remove('hidden');
    }

    // Hide search results when clicking outside
    document.addEventListener('click', function(event) {
        if (!searchInput.contains(event.target) && !searchResults.contains(event.target)) {
            searchResults.classList.add('hidden');
        }
    });
});
</script>
{% endblock %}