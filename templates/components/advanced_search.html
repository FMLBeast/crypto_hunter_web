< !-- Advanced
Search
Component -->
< div


class ="bg-white rounded-lg shadow-sm p-4 mb-4" >

< div


class ="space-y-4" >

< !-- Main
Search
Bar -->
< div


class ="relative" >

< div


class ="flex" >

< div


class ="relative flex-1" >

< input
type = "text"
id = "hyperfast-search"
placeholder = "Hyperfast search: filename, SHA, patterns, content..."


class ="w-full px-4 py-2 pr-12 border border-gray-300 rounded-l-md focus:outline-none focus:ring-2 focus:ring-indigo-500" >

< div


class ="absolute inset-y-0 right-0 flex items-center pr-3" >

< i


class ="fas fa-search text-gray-400" > < / i >

< / div >
< / div >
< button
id = "search-btn"


class ="bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-2 rounded-r-md" >


Search
< / button >
< button
id = "magic-search-btn"


class ="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 ml-2 rounded" >


Magic
< / button >
< / div >

< !-- Search
Suggestions -->
< div
id = "search-suggestions"


class ="absolute z-50 w-full bg-white border border-gray-300 rounded-md shadow-lg mt-1 hidden" >

< !-- Suggestions
populated
by
JS -->
< / div >
< / div >

< !-- Advanced
Filters
Row -->
< div


class ="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-3" >

< select
id = "filter-type"


class ="px-3 py-2 border border-gray-300 rounded text-sm" >

< option
value = "" > All
Types < / option >
< option
value = "image" > Images < / option >
< option
value = "text" > Text < / option >
< option
value = "binary" > Binary < / option >
< option
value = "archive" > Archives < / option >
< / select >

< select
id = "filter-status"


class ="px-3 py-2 border border-gray-300 rounded text-sm" >

< option
value = "" > All
Status < / option >
< option
value = "pending" > Pending < / option >
< option
value = "complete" > Complete < / option >
< option
value = "analyzing" > Analyzing < / option >
< / select >

< select
id = "filter-priority"


class ="px-3 py-2 border border-gray-300 rounded text-sm" >

< option
value = "" > All
Priority < / option >
< option
value = "1" > 1 + Low < / option >
< option
value = "5" > 5 + Medium < / option >
< option
value = "8" > 8 + High < / option >
< / select >

< input
type = "number"
id = "filter-min-size"
placeholder = "Min size (bytes)"


class ="px-3 py-2 border border-gray-300 rounded text-sm" >

< input
type = "number"
id = "filter-max-size"
placeholder = "Max size (bytes)"


class ="px-3 py-2 border border-gray-300 rounded text-sm" >

< label


class ="flex items-center px-3 py-2 text-sm" >

< input
type = "checkbox"
id = "filter-root-only"


class ="mr-2" >


Root
only
< / label >
< / div >

< !-- Search
Modes -->
< div


class ="flex flex-wrap gap-2" >

< button
id = "mode-normal"


class ="mode-btn active px-3 py-1 bg-blue-100 text-blue-800 rounded text-sm" >


Normal
Search
< / button >
< button
id = "mode-group"


class ="mode-btn px-3 py-1 bg-gray-100 text-gray-800 rounded text-sm" >


Group
by
Type
< / button >
< button
id = "mode-xor"


class ="mode-btn px-3 py-1 bg-gray-100 text-gray-800 rounded text-sm" >


XOR
Analysis
< / button >
< button
id = "mode-pattern"


class ="mode-btn px-3 py-1 bg-gray-100 text-gray-800 rounded text-sm" >


Pattern
Search
< / button >
< / div >

< !-- XOR
Selection(hidden
by
default) -->
< div
id = "xor-panel"


class ="hidden bg-yellow-50 border border-yellow-200 rounded p-3" >

< div


class ="flex items-center justify-between mb-2" >

< span


class ="text-sm font-medium text-yellow-800" > XOR Analysis Mode < / span >

< span
id = "xor-count"


class ="text-xs text-yellow-600" > 0 files selected < / span >

< / div >
< div
id = "xor-files"


class ="space-y-1" >

< !-- Selected
files
for XOR -->
< / div >
< button
id = "perform-xor"


class ="mt-2 bg-yellow-600 hover:bg-yellow-700 text-white px-3 py-1 rounded text-sm" >


Analyze
Correlations
< / button >
< / div >
< / div >
< / div >

< !-- Search
Results -->
< div
id = "search-results"


class ="space-y-4" >

< !-- Results
populated
by
JS -->
< / div >

< !-- Search
Performance
Stats -->
< div
id = "search-stats"


class ="hidden bg-gray-50 border border-gray-200 rounded p-3 mt-4" >

< div


class ="flex items-center justify-between text-sm text-gray-600" >

< span > Search
completed in < span
id = "search-time" > 0 < / span > ms < / span >
< span > Found < span
id = "result-count" > 0 < / span > results < / span >
< span > Query
type: < span
id = "query-type" > unknown < / span > < / span >
< / div >
< / div >

< script >


class HyperfastSearch {
constructor() {
this.searchInput = document.getElementById('hyperfast-search');
this.searchBtn = document.getElementById('search-btn');
this.magicBtn = document.getElementById('magic-search-btn');
this.suggestionsDiv = document.getElementById('search-suggestions');
this.resultsDiv = document.getElementById('search-results');
this.statsDiv = document.getElementById('search-stats');

this.currentMode = 'normal';
this.xorSelection = new Set();
this.searchCache = new Map();

this.init();
}

init() {
// Main search
this.searchInput.addEventListener('input', this.debounce(this.handleInput.bind(this), 200));
this.searchInput.addEventListener('keydown', this.handleKeydown.bind(this));
this.searchBtn.addEventListener('click', this.performSearch.bind(this));
this.magicBtn.addEventListener('click', this.performMagicSearch.bind(this));

// Mode buttons
document.querySelectorAll('.mode-btn').forEach(btn = > {
btn.addEventListener('click', this.switchMode.bind(this));
});

// Filter change handlers
['filter-type', 'filter-status', 'filter-priority', 'filter-min-size', 'filter-max-size', 'filter-root-only'].forEach(id = > {
const element = document.getElementById(id);
if (element) {
element.addEventListener('change', this.debounce(this.performSearch.bind(this), 300));
}
});

// XOR analysis
document.getElementById('perform-xor').addEventListener('click', this.performXORAnalysis.bind(this));

// Click outside to hide suggestions
document.addEventListener('click', (e) = > {
if (!this.searchInput.contains(e.target) & & !this.suggestionsDiv.contains(e.target)) {
this.hideSuggestions();
}
});
}

debounce(func, wait) {
let timeout;


return function
executedFunction(...
args) {
    const
later = () = > {
    clearTimeout(timeout);
func(...
args);
};
clearTimeout(timeout);
timeout = setTimeout(later, wait);
};
}

handleInput(e)
{
const
query = e.target.value.trim();

if (query.length >= 2) {
this.fetchSuggestions(query);
if (this.currentMode == = 'normal') {
this.performSearch();
}
} else {
this.hideSuggestions();
}
}

handleKeydown(e)
{
if (e.key === 'Enter') {
this.performSearch();
this.hideSuggestions();
} else if (e.key == = 'Escape') {
this.hideSuggestions();
}
}

async fetchSuggestions(query)
{
try {
const response = await fetch(` / search_api / search / suggestions?q=${encodeURIComponent(query)}`);
const data = await response.json();

this.showSuggestions(data.suggestions | |[]);
} catch (error) {
console.error('Suggestion fetch error:', error);
}
}

showSuggestions(suggestions)
{
if (suggestions.length === 0) {
this.hideSuggestions();
return;
}

const
html = suggestions.map(s= > `
< div


class ="suggestion-item px-4 py-2 hover:bg-gray-50 cursor-pointer border-b border-gray-100 last:border-b-0"


data - text = "${s.text}"
data - type = "${s.type}"
data - sha = "${s.sha || ''}" >
< div


class ="flex items-center justify-between" >

< div >
< div


class ="font-medium text-gray-900" > ${s.text} < / div >

${s.file_type ? ` < div


class ="text-sm text-gray-500" > ${s.file_type} < / div > `: ''

}
< / div >
    < span


class ="text-xs px-2 py-0.5 bg-gray-100 text-gray-600 rounded" > ${s.type} < / span >

< / div >
< / div >
`).join('');

this.suggestionsDiv.innerHTML = html;
this.suggestionsDiv.classList.remove('hidden');

// Add
click
handlers
this.suggestionsDiv.querySelectorAll('.suggestion-item').forEach(item= > {
    item.addEventListener('click', (e) = > {
    const
text = e.currentTarget.dataset.text;
const
sha = e.currentTarget.dataset.sha;

this.searchInput.value = text;
this.hideSuggestions();

if (sha)
{
    window.open(` / files /${sha}
`, '_blank');
} else {
    this.performSearch();
}
});
});
}

hideSuggestions()
{
    this.suggestionsDiv.classList.add('hidden');
}

switchMode(e)
{
    document.querySelectorAll('.mode-btn').forEach(btn= > btn.classList.remove('active', 'bg-blue-100',
                                                                               'text-blue-800'));
document.querySelectorAll('.mode-btn').forEach(btn= > btn.classList.add('bg-gray-100', 'text-gray-800'));

e.target.classList.remove('bg-gray-100', 'text-gray-800');
e.target.classList.add('active', 'bg-blue-100', 'text-blue-800');

this.currentMode = e.target.id.replace('mode-', '');

// Show / hide
XOR
panel
const
xorPanel = document.getElementById('xor-panel');
if (this.currentMode === 'xor')
{
xorPanel.classList.remove('hidden');
} else {
xorPanel.classList.add('hidden');
}

this.performSearch();
}

async performSearch()
{
    const
startTime = Date.now();
const
query = this.searchInput.value.trim();

if (this.currentMode === 'group')
{
return this.performGroupSearch();
}

try {
const filters = this.getFilters();
const cacheKey = `${query}_${JSON.stringify(filters)}_${this.currentMode}`;

// Check cache first
if (this.searchCache.has(cacheKey)) {
this.displayResults(this.searchCache.get(cacheKey), Date.now() - startTime);
return;
}

const
params = new
URLSearchParams({
    q: query,
    limit: 100,
    ...filters
});

const
response = await fetch(` / search_api / search / hyperfast?${params}
`);
const
data = await response.json();

if (data.success)
{
this.searchCache.set(cacheKey, data);
this.displayResults(data, Date.now() - startTime);
} else {
this.showError(data.error | | 'Search failed');
}

} catch(error)
{
    console.error('Search error:', error);
this.showError('Search request failed');
}
}

async performMagicSearch()
{
    const
query = this.searchInput.value.trim();
if (!query)
return;

try {
const response = await fetch(` / search_api / search / magic?q=${encodeURIComponent(query)}`);
const data = await response.json();

if (data.success) {
this.displayMagicResults(data);
}
} catch (error) {
console.error('Magic search error:', error);
}
}

async performGroupSearch()
{
try {
const filters = this.getFilters();
const params = new URLSearchParams({
group_by: 'type',
...
filters
});

const
response = await fetch(` / search_api / search / group?${params}
`);
const
data = await response.json();

if (data.success)
{
    this.displayGroupResults(data);
}
} catch(error)
{
    console.error('Group search error:', error);
}
}

async performXORAnalysis()
{
if (this.xorSelection.size < 2) {
alert('Select at least 2 files for XOR analysis');
return;
}

try {
const response = await fetch('/search_api/search/xor', {
method: 'POST',
headers: {'Content-Type': 'application/json'},
body: JSON.stringify({sha_list: Array.
from

(this.xorSelection)})
});

const
data = await response.json();

if (data.success)
{
    this.displayXORResults(data);
}
} catch(error)
{
    console.error('XOR analysis error:', error);
}
}

getFilters()
{
const
filters = {};

const
fileType = document.getElementById('filter-type').value;
if (fileType) filters.file_type = fileType;

const
status = document.getElementById('filter-status').value;
if (status) filters.status = status;

const
priority = document.getElementById('filter-priority').value;
if (priority) filters.priority_min = priority;

const
minSize = document.getElementById('filter-min-size').value;
if (minSize) filters.min_size = minSize;

const
maxSize = document.getElementById('filter-max-size').value;
if (maxSize) filters.max_size = maxSize;

const
rootOnly = document.getElementById('filter-root-only').checked;
if (rootOnly) filters.is_root = 'true';

return filters;
}

displayResults(data, searchTime)
{
const
results = data.results;
const
files = results.files | | [];

// Show
stats
document.getElementById('search-time').textContent = searchTime;
document.getElementById('result-count').textContent = files.length;
document.getElementById('query-type').textContent = results.search_type | | 'unknown';
this.statsDiv.classList.remove('hidden');

if (files.length === 0) {
this.resultsDiv.innerHTML = `
< div


class ="text-center py-8 text-gray-500" >

< i


class ="fas fa-search text-3xl mb-4" > < / i >

< p > No
files
found
matching
your
search
criteria < / p >
< / div >
`;
return;
}

const
html = files.map(file= > `
< div


class ="bg-white rounded-lg shadow-sm p-4 hover:shadow-md transition-shadow" >

< div


class ="flex items-center justify-between" >

< div


class ="flex items-center space-x-3" >

${file.is_root_file ?
'<i class="fas fa-gem text-purple-500"></i>':
'<i class="fas fa-file text-gray-400"></i>'
}
< div >
< h3


class ="font-medium text-gray-900" >

< a
href = "/files/${file.sha256_hash}"


class ="hover:text-indigo-600" >

${file.filename}
< / a >
< / h3 >
< div


class ="flex items-center space-x-2 text-sm text-gray-500 mt-1" >

< span >${file.file_type} < / span >
< span >• < / span >
< span >${this.formatFileSize(file.file_size)} < / span >
< span >• < / span >
< span


class ="font-mono" > ${file.sha256_hash.substring(0, 12)}...< / span >

< / div >
< / div >
< / div >
< div


class ="flex items-center space-x-2" >

< span


class ="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium

${file.status == = 'complete' ? 'bg-green-100 text-green-800':
file.status == = 'pending' ? 'bg-yellow-100 text-yellow-800':
'bg-gray-100 text-gray-800'}">
${file.status}
< / span >
${this.currentMode == = 'xor' ? `
                                < button
onclick = "hyperfastSearch.toggleXORSelection('${file.sha256_hash}', '${file.filename}')"


class ="xor-toggle px-2 py-1 text-xs border rounded ${


this.xorSelection.has(file.sha256_hash) ?
'bg-yellow-100 text-yellow-800 border-yellow-300':
'bg-gray-100 text-gray-600 border-gray-300'
}">
${this.xorSelection.has(file.sha256_hash) ? 'Selected': 'Select'}
< / button >
    `: ''}
< / div >
    < / div >
        < / div >
            `).join('');

this.resultsDiv.innerHTML = html;
}

displayMagicResults(data)
{
// Similar
to
displayResults
but
with magic - specific formatting
this.displayResults(data, 0);

// Add magic patterns info
if (data.magic_patterns_detected) {
const magicInfo = document.createElement('div');
magicInfo.className = 'bg-purple-50 border border-purple-200 rounded p-3 mb-4';
magicInfo.innerHTML = `
< div


class ="flex items-center" >

< i


class ="fas fa-magic text-purple-600 mr-2" > < / i >

< span


class ="text-purple-800" > Magic pattern detected: $


    {data.magic_patterns_detected} < / span >
< / div >
`;
this.resultsDiv.insertBefore(magicInfo, this.resultsDiv.firstChild);
}
}

displayGroupResults(data)
{
    const
groups = data.results.groups | | [];

const
html = `
       < div


class ="bg-white rounded-lg shadow-sm p-4" >

< h3


class ="font-semibold text-gray-900 mb-4" > Files grouped by ${data.results.group_by} < / h3 >

< div


class ="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" >

${groups.map(group= > `
  < div


class ="bg-gray-50 rounded p-3" >

< div


class ="text-lg font-medium text-gray-900" > ${group.key | | 'Unknown'} < / div >

< div


class ="text-2xl font-bold text-indigo-600" > ${group.count} < / div >

< div


class ="text-sm text-gray-500" > files < / div >

< / div >
`).join('')}
< / div >
    < / div >
        `;

this.resultsDiv.innerHTML = html;
}

displayXORResults(data)
{
    const
correlations = data.results.correlations | | {};

const
html = `
       < div


class ="bg-white rounded-lg shadow-sm p-4" >

< h3


class ="font-semibold text-gray-900 mb-4" > XOR Correlation Analysis < / h3 >

< div


class ="grid grid-cols-1 lg:grid-cols-2 gap-6" >

< div >
< h4


class ="font-medium text-gray-700 mb-2" > Size Relationships < / h4 >

< div


class ="space-y-2" >

${correlations.size_relationships ?
correlations.size_relationships.map(ratio= >
` < div


class ="text-sm" > Ratio: $


    {ratio.toFixed(2)} < / div > `
).join(''):
'<div class="text-sm text-gray-500">No size patterns found</div>'
}
< / div >
    < / div >

        < div >
        < h4


class ="font-medium text-gray-700 mb-2" > Type Distribution < / h4 >

< div


class ="space-y-2" >

${Object.entries(correlations.type_similarities | | {}).map(([type, count]) = >
` < div


class ="flex justify-between text-sm" >

< span >${type} < / span >
< span >${count} < / span >
< / div > `
).join('')}
< / div >
    < / div >
        < / div >

            < div


class ="mt-6" >

< h4


class ="font-medium text-gray-700 mb-2" > Selected Files < / h4 >

< div


class ="space-y-2" >

${data.results.files.map(file= > `
  < div


class ="flex items-center justify-between p-2 bg-gray-50 rounded" >

< div >
< div


class ="font-medium" > ${file.filename} < / div >

< div


class ="text-sm text-gray-500" > ${file.file_type} • ${this.formatFileSize(file.file_size)} < / div >

< / div >
< a
href = "/files/${file.sha256_hash}"


class ="text-indigo-600 hover:text-indigo-800" >

< i


class ="fas fa-external-link-alt" > < / i >

< / a >
< / div >
`).join('')}
< / div >
    < / div >
        < / div >
            `;

this.resultsDiv.innerHTML = html;
}

toggleXORSelection(sha, filename)
{
if (this.xorSelection.has(sha))
{
    this.xorSelection.delete(sha);
} else {
    this.xorSelection.add(sha);
}

this.updateXORPanel();
this.performSearch(); // Refresh
to
update
button
states
}

updateXORPanel()
{
    const
count = document.getElementById('xor-count');
const
filesDiv = document.getElementById('xor-files');

count.textContent = `${this.xorSelection.size}
files
selected
`;

if (this.xorSelection.size === 0)
{
    filesDiv.innerHTML = '<div class="text-sm text-gray-500">No files selected</div>';
} else {
    const
html = Array.
from

(this.xorSelection).map(sha= > `
< div


class ="flex items-center justify-between text-sm" >

< span


class ="font-mono" > ${sha.substring(0, 16)}...< / span >

< button
onclick = "hyperfastSearch.toggleXORSelection('${sha}')"


class ="text-red-600 hover:text-red-800" >

< i


class ="fas fa-times" > < / i >

< / button >
< / div >
`).join('');

filesDiv.innerHTML = html;
}
}

formatFileSize(bytes)
{
if (!bytes)
return 'Unknown';
if (bytes < 1024) return `${bytes} B`;
if (bytes < 1024 * 1024) return `${(bytes / 1024).toFixed(1)} KB`;
if (bytes < 1024 * 1024 * 1024) return `${(bytes / (1024 * 1024)).toFixed(1)} MB`;
return `${(bytes / (1024 * 1024 * 1024)).toFixed(1)}
GB
`;
}

showError(message)
{
this.resultsDiv.innerHTML = `
< div


class ="bg-red-50 border border-red-200 rounded p-4" >

< div


class ="flex items-center" >

< i


class ="fas fa-exclamation-triangle text-red-600 mr-2" > < / i >

< span


class ="text-red-800" > ${message} < / span >

< / div >
< / div >
`;
}
}

// Initialize
when
DOM is loaded
document.addEventListener('DOMContentLoaded', function()
{
window.hyperfastSearch = new
HyperfastSearch();
});
< / script >