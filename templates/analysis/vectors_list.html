{% extends "base.html" %}

{% block title %}Analysis Vectors - Arweave Puzzle #11{% endblock %}

{% block content %}
<div class="space-y-6">
    <!-- Header -->
    <div class="bg-white rounded-lg shadow p-6">
        <div class="flex items-center justify-between">
            <div>
                <h1 class="text-2xl font-bold text-gray-900">Analysis Vectors</h1>
                <p class="mt-1 text-gray-600">Organized analysis tracks for systematic investigation</p>
            </div>
            <button onclick="createVector()" class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-md font-medium">
                <i class="fas fa-plus mr-2"></i>Add Vector
            </button>
        </div>
    </div>

    <!-- Vectors Grid -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        {% for vector in vectors %}
        <div class="bg-white rounded-lg shadow hover:shadow-lg transition-shadow duration-200">
            <!-- Vector Header -->
            <div class="p-6 border-b border-gray-200">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-3">
                        <div class="flex-shrink-0">
                            <div class="w-12 h-12 rounded-full flex items-center justify-center" 
                                 style="background-color: {{ vector.color }}20; color: {{ vector.color }};">
                                <span class="text-2xl">{{ vector.icon }}</span>
                            </div>
                        </div>
                        <div>
                            <h3 class="text-lg font-semibold text-gray-900">{{ vector.name }}</h3>
                            <p class="text-sm text-gray-600">{{ vector.description[:50] }}{% if vector.description|length > 50 %}...{% endif %}</p>
                        </div>
                    </div>
                    <div class="flex space-x-2">
                        <button onclick="editVector({{ vector.id }})" class="text-gray-400 hover:text-gray-600">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button onclick="deleteVector({{ vector.id }})" class="text-gray-400 hover:text-red-600">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Vector Stats -->
            <div class="p-6">
                <div class="space-y-4">
                    <!-- Progress Bar -->
                    <div>
                        <div class="flex items-center justify-between text-sm text-gray-600 mb-2">
                            <span>Analysis Progress</span>
                            <span>{{ vector.progress_percentage }}%</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-2">
                            <div class="h-2 rounded-full transition-all duration-300" 
                                 style="width: {{ vector.progress_percentage }}%; background-color: {{ vector.color }};"></div>
                        </div>
                    </div>

                    <!-- Statistics -->
                    <div class="grid grid-cols-2 gap-4">
                        <div class="text-center">
                            <div class="text-2xl font-bold text-gray-900">{{ vector.findings_count }}</div>
                            <div class="text-xs text-gray-500">Findings</div>
                        </div>
                        <div class="text-center">
                            <div class="text-2xl font-bold text-gray-900">{{ vector.files_analyzed }}</div>
                            <div class="text-xs text-gray-500">Files Analyzed</div>
                        </div>
                    </div>

                    <!-- Status Badge -->
                    <div class="flex items-center justify-center">
                        <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium 
                            {% if vector.status == 'active' %}bg-green-100 text-green-800
                            {% elif vector.status == 'paused' %}bg-yellow-100 text-yellow-800
                            {% else %}bg-gray-100 text-gray-800{% endif %}">
                            {% if vector.status == 'active' %}
                                <i class="fas fa-play mr-1"></i>Active
                            {% elif vector.status == 'paused' %}
                                <i class="fas fa-pause mr-1"></i>Paused
                            {% else %}
                                <i class="fas fa-stop mr-1"></i>Inactive
                            {% endif %}
                        </span>
                    </div>

                    <!-- Action Buttons -->
                    <div class="flex space-x-2 pt-2">
                        <a href="{{ url_for('analysis.findings_list', vector=vector.id) }}" 
                           class="flex-1 text-center bg-blue-50 hover:bg-blue-100 text-blue-700 px-3 py-2 rounded text-sm font-medium">
                            <i class="fas fa-search mr-1"></i>View Findings
                        </a>
                        <button onclick="assignFiles({{ vector.id }})" 
                                class="flex-1 text-center bg-green-50 hover:bg-green-100 text-green-700 px-3 py-2 rounded text-sm font-medium">
                            <i class="fas fa-plus mr-1"></i>Assign Files
                        </button>
                    </div>
                </div>
            </div>

            <!-- Recent Findings Preview -->
            {% if vector.findings %}
            <div class="border-t border-gray-200 px-6 py-4">
                <h4 class="text-sm font-medium text-gray-900 mb-2">Recent Findings</h4>
                <div class="space-y-2">
                    {% for finding in vector.findings[:3] %}
                    <div class="flex items-center justify-between text-xs">
                        <div class="flex items-center space-x-2">
                            <div class="w-2 h-2 rounded-full" style="background-color: {{ vector.color }};"></div>
                            <span class="text-gray-700 truncate">{{ finding.title[:30] }}{% if finding.title|length > 30 %}...{% endif %}</span>
                        </div>
                        <div class="flex items-center space-x-1">
                            {% for i in range(1, 6) %}
                                <i class="fas fa-star text-xs {% if i <= finding.confidence_level//2 %}text-yellow-400{% else %}text-gray-300{% endif %}"></i>
                            {% endfor %}
                        </div>
                    </div>
                    {% endfor %}
                    {% if vector.findings|length > 3 %}
                    <div class="text-xs text-gray-500 text-center pt-1">
                        +{{ vector.findings|length - 3 }} more findings
                    </div>
                    {% endif %}
                </div>
            </div>
            {% endif %}
        </div>
        {% endfor %}
    </div>

    {% if not vectors %}
    <!-- Empty State -->
    <div class="bg-white rounded-lg shadow p-12 text-center">
        <i class="fas fa-vector-square text-gray-400 text-4xl mb-4"></i>
        <h3 class="text-lg font-medium text-gray-900 mb-2">No Analysis Vectors</h3>
        <p class="text-gray-600 mb-6">Create analysis vectors to organize your investigation workflow.</p>
        <button onclick="createVector()" class="bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-2 rounded-md font-medium">
            <i class="fas fa-plus mr-2"></i>Create First Vector
        </button>
    </div>
    {% endif %}

    <!-- Vector Templates -->
    <div class="bg-white rounded-lg shadow p-6">
        <h2 class="text-lg font-semibold text-gray-900 mb-4">Suggested Vector Templates</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
            <button onclick="createFromTemplate('image_stego')" 
                    class="p-4 border-2 border-dashed border-gray-300 rounded-lg hover:border-indigo-300 hover:bg-indigo-50 transition-colors">
                <div class="text-center">
                    <span class="text-2xl mb-2 block">üñºÔ∏è</span>
                    <div class="text-sm font-medium text-gray-900">Image Steganography</div>
                    <div class="text-xs text-gray-500 mt-1">ZSteg, Steghide, LSB analysis</div>
                </div>
            </button>

            <button onclick="createFromTemplate('audio_stego')" 
                    class="p-4 border-2 border-dashed border-gray-300 rounded-lg hover:border-indigo-300 hover:bg-indigo-50 transition-colors">
                <div class="text-center">
                    <span class="text-2xl mb-2 block">üéµ</span>
                    <div class="text-sm font-medium text-gray-900">Audio Steganography</div>
                    <div class="text-xs text-gray-500 mt-1">Spectral analysis, audio patterns</div>
                </div>
            </button>

            <button onclick="createFromTemplate('file_carving')" 
                    class="p-4 border-2 border-dashed border-gray-300 rounded-lg hover:border-indigo-300 hover:bg-indigo-50 transition-colors">
                <div class="text-center">
                    <span class="text-2xl mb-2 block">üîç</span>
                    <div class="text-sm font-medium text-gray-900">File Carving</div>
                    <div class="text-xs text-gray-500 mt-1">Binwalk, foremost, scalpel</div>
                </div>
            </button>

            <button onclick="createFromTemplate('crypto_analysis')" 
                    class="p-4 border-2 border-dashed border-gray-300 rounded-lg hover:border-indigo-300 hover:bg-indigo-50 transition-colors">
                <div class="text-center">
                    <span class="text-2xl mb-2 block">üîê</span>
                    <div class="text-sm font-medium text-gray-900">Cryptography</div>
                    <div class="text-xs text-gray-500 mt-1">Hash analysis, cipher detection</div>
                </div>
            </button>
        </div>
    </div>
</div>

<!-- Vector Modal -->
<div id="vectorModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden items-center justify-center z-50">
    <div class="bg-white rounded-lg p-6 max-w-md w-full mx-4">
        <div id="vectorModalContent">
            <!-- Modal content will be populated by JavaScript -->
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
const vectorTemplates = {
    image_stego: {
        name: 'Image Steganography',
        description: 'Analysis of hidden data in image files using LSB, DCT, and frequency domain techniques',
        color: '#ef4444',
        icon: 'üñºÔ∏è'
    },
    audio_stego: {
        name: 'Audio Steganography',
        description: 'Detection of hidden content in audio files through spectral and temporal analysis',
        color: '#f97316',
        icon: 'üéµ'
    },
    file_carving: {
        name: 'File Carving',
        description: 'Extraction of embedded files and data structures using signature-based analysis',
        color: '#eab308',
        icon: 'üîç'
    },
    crypto_analysis: {
        name: 'Cryptographic Analysis',
        description: 'Hash analysis, encryption detection, and cipher identification',
        color: '#8b5cf6',
        icon: 'üîê'
    }
};

function createVector() {
    showVectorModal('Create New Vector', `
        <form onsubmit="submitVector(event)" class="space-y-4">
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Name *</label>
                <input type="text" name="name" required 
                       class="w-full px-3 py-2 border border-gray-300 rounded-md">
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Description</label>
                <textarea name="description" rows="3" 
                          class="w-full px-3 py-2 border border-gray-300 rounded-md"></textarea>
            </div>
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Color</label>
                    <input type="color" name="color" value="#3b82f6" 
                           class="w-full h-10 border border-gray-300 rounded-md">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Icon (Emoji)</label>
                    <input type="text" name="icon" value="üìÅ" maxlength="2" 
                           class="w-full px-3 py-2 border border-gray-300 rounded-md text-center">
                </div>
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Status</label>
                <select name="status" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                    <option value="active">Active</option>
                    <option value="paused">Paused</option>
                    <option value="inactive">Inactive</option>
                </select>
            </div>
            <div class="flex justify-end space-x-2">
                <button type="button" onclick="closeVectorModal()" 
                        class="px-4 py-2 text-gray-600 border border-gray-300 rounded-md hover:bg-gray-50">
                    Cancel
                </button>
                <button type="submit" 
                        class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700">
                    Create Vector
                </button>
            </div>
        </form>
    `);
}

function createFromTemplate(templateKey) {
    const template = vectorTemplates[templateKey];
    if (!template) return;

    showVectorModal('Create Vector from Template', `
        <form onsubmit="submitVector(event)" class="space-y-4">
            <div class="bg-blue-50 p-4 rounded-lg">
                <div class="flex items-center space-x-3">
                    <span class="text-2xl">${template.icon}</span>
                    <div>
                        <h4 class="font-medium text-blue-900">${template.name}</h4>
                        <p class="text-sm text-blue-700">${template.description}</p>
                    </div>
                </div>
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Name *</label>
                <input type="text" name="name" value="${template.name}" required 
                       class="w-full px-3 py-2 border border-gray-300 rounded-md">
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Description</label>
                <textarea name="description" rows="3" 
                          class="w-full px-3 py-2 border border-gray-300 rounded-md">${template.description}</textarea>
            </div>
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Color</label>
                    <input type="color" name="color" value="${template.color}" 
                           class="w-full h-10 border border-gray-300 rounded-md">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Icon (Emoji)</label>
                    <input type="text" name="icon" value="${template.icon}" maxlength="2" 
                           class="w-full px-3 py-2 border border-gray-300 rounded-md text-center">
                </div>
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Status</label>
                <select name="status" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                    <option value="active" selected>Active</option>
                    <option value="paused">Paused</option>
                    <option value="inactive">Inactive</option>
                </select>
            </div>
            <div class="flex justify-end space-x-2">
                <button type="button" onclick="closeVectorModal()" 
                        class="px-4 py-2 text-gray-600 border border-gray-300 rounded-md hover:bg-gray-50">
                    Cancel
                </button>
                <button type="submit" 
                        class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700">
                    Create Vector
                </button>
            </div>
        </form>
    `);
}

function editVector(vectorId) {
    // Implementation for editing vectors
    showNotification('Edit vector feature coming soon', 'info');
}

function deleteVector(vectorId) {
    if (confirm('Delete this analysis vector? This will also delete all associated findings.')) {
        // Implementation for deleting vectors
        showNotification('Delete vector feature coming soon', 'info');
    }
}

function assignFiles(vectorId) {
    // Implementation for assigning files to vectors
    showNotification('File assignment feature coming soon', 'info');
}

function submitVector(event) {
    event.preventDefault();
    const formData = new FormData(event.target);
    
    const vectorData = {
        name: formData.get('name'),
        description: formData.get('description'),
        color: formData.get('color'),
        icon: formData.get('icon'),
        status: formData.get('status')
    };
    
    // Here you would typically send the data to the server
    console.log('Creating vector:', vectorData);
    
    closeVectorModal();
    showNotification('Vector creation feature coming soon', 'info');
}

function showVectorModal(title, content) {
    document.getElementById('vectorModalContent').innerHTML = `
        <h3 class="text-lg font-medium text-gray-900 mb-4">${title}</h3>
        ${content}
    `;
    document.getElementById('vectorModal').classList.remove('hidden');
    document.getElementById('vectorModal').classList.add('flex');
}

function closeVectorModal() {
    document.getElementById('vectorModal').classList.add('hidden');
    document.getElementById('vectorModal').classList.remove('flex');
}

// Close modal when clicking outside
document.getElementById('vectorModal').addEventListener('click', function(e) {
    if (e.target === this) {
        closeVectorModal();
    }
});
</script>
{% endblock %}